<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Results - Matka King</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>MATKA KING</h1>
                <p>Results Management System</p>
            </div>
            <div class="header-buttons">
                <a href="index.html" class="btn btn-outline"><i class="fas fa-home"></i> Home</a>
                <a href="admin.html" class="btn btn-danger"><i class="fas fa-lock"></i> Admin Panel</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div class="admin-panel">
            <!-- Page Header -->
            <div class="admin-header">
                <h1><i class="fas fa-edit"></i> MANAGE RESULTS</h1>
                <p>Update and publish results for all 6 markets</p>
            </div>

            <!-- Quick Stats -->
            <div class="admin-card">
                <h3><i class="fas fa-chart-bar"></i> TODAY'S OVERVIEW</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="text-align: center; padding: 15px; background: rgba(0, 230, 118, 0.1); border-radius: 5px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #00e676;">2</div>
                        <div style="font-size: 0.9rem; color: #a0a0c0;">Published</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 152, 0, 0.1); border-radius: 5px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ff9800;">3</div>
                        <div style="font-size: 0.9rem; color: #a0a0c0;">Ready</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(158, 158, 158, 0.1); border-radius: 5px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #9e9e9e;">1</div>
                        <div style="font-size: 0.9rem; color: #a0a0c0;">Pending</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 5px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #2196f3;">6</div>
                        <div style="font-size: 0.9rem; color: #a0a0c0;">Total</div>
                    </div>
                </div>
            </div>

            <!-- Results Update Form -->
            <div class="admin-card">
                <h3><i class="fas fa-flag-checkered"></i> UPDATE RESULTS</h3>
                
                <div class="date-selector" style="margin-bottom: 20px;">
                    <button class="date-btn active">Today</button>
                    <button class="date-btn">Yesterday</button>
                    <button class="date-btn">Previous 7 Days</button>
                    <button class="date-btn">Custom Date</button>
                </div>
                
                <div class="results-form-grid">
                    <!-- Faridabad -->
                    <div class="result-set-card">
                        <h4>FARIDABAD</h4>
                        <div class="form-group">
                            <label>Result:</label>
                            <input type="text" class="form-control" id="update-faridabad" 
                                   placeholder="00-99" maxlength="2" pattern="[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select class="form-control" id="status-faridabad">
                                <option value="pending">Pending</option>
                                <option value="ready">Ready</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <button class="btn btn-success btn-block" onclick="updateResult('faridabad')">
                            <i class="fas fa-check"></i> Update
                        </button>
                    </div>
                    
                    <!-- Gaziabad -->
                    <div class="result-set-card">
                        <h4>GAZIABAD</h4>
                        <div class="form-group">
                            <label>Result:</label>
                            <input type="text" class="form-control" id="update-gaziabad" 
                                   placeholder="00-99" maxlength="2" pattern="[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select class="form-control" id="status-gaziabad">
                                <option value="pending">Pending</option>
                                <option value="ready">Ready</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <button class="btn btn-success btn-block" onclick="updateResult('gaziabad')">
                            <i class="fas fa-check"></i> Update
                        </button>
                    </div>
                    
                    <!-- Gali -->
                    <div class="result-set-card">
                        <h4>GALI</h4>
                        <div class="form-group">
                            <label>Result:</label>
                            <input type="text" class="form-control" id="update-gali" 
                                   placeholder="00-99" maxlength="2" pattern="[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select class="form-control" id="status-gali">
                                <option value="pending">Pending</option>
                                <option value="ready">Ready</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <button class="btn btn-success btn-block" onclick="updateResult('gali')">
                            <i class="fas fa-check"></i> Update
                        </button>
                    </div>
                    
                    <!-- Deshwar -->
                    <div class="result-set-card">
                        <h4>DESHWAR</h4>
                        <div class="form-group">
                            <label>Result:</label>
                            <input type="text" class="form-control" id="update-deshwar" 
                                   placeholder="00-99" maxlength="2" pattern="[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select class="form-control" id="status-deshwar">
                                <option value="pending">Pending</option>
                                <option value="ready">Ready</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <button class="btn btn-success btn-block" onclick="updateResult('deshwar')">
                            <i class="fas fa-check"></i> Update
                        </button>
                    </div>
                    
                    <!-- Gali Dubai -->
                    <div class="result-set-card">
                        <h4>GALI DUBAI</h4>
                        <div class="form-group">
                            <label>Result:</label>
                            <input type="text" class="form-control" id="update-gali-dubai" 
                                   placeholder="00-99" maxlength="2" pattern="[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select class="form-control" id="status-gali-dubai">
                                <option value="pending">Pending</option>
                                <option value="ready">Ready</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <button class="btn btn-success btn-block" onclick="updateResult('gali_dubai')">
                            <i class="fas fa-check"></i> Update
                        </button>
                    </div>
                    
                    <!-- Deshwar Dubai -->
                    <div class="result-set-card">
                        <h4>DESHWAR DUBAI</h4>
                        <div class="form-group">
                            <label>Result:</label>
                            <input type="text" class="form-control" id="update-deshwar-dubai" 
                                   placeholder="00-99" maxlength="2" pattern="[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select class="form-control" id="status-deshwar-dubai">
                                <option value="pending">Pending</option>
                                <option value="ready">Ready</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <button class="btn btn-success btn-block" onclick="updateResult('deshwar_dubai')">
                            <i class="fas fa-check"></i> Update
                        </button>
                    </div>
                </div>
                
                <!-- Bulk Actions -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <h4><i class="fas fa-bolt"></i> BULK ACTIONS</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="saveAllResults()">
                            <i class="fas fa-save"></i> Save All Changes
                        </button>
                        <button class="btn btn-success" onclick="publishAllReady()">
                            <i class="fas fa-broadcast-tower"></i> Publish All Ready
                        </button>
                        <button class="btn btn-danger" onclick="clearAllResults()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results History -->
            <div class="admin-card">
                <h3><i class="fas fa-history"></i> RECENT RESULTS HISTORY</h3>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Market</th>
                                <th>Result</th>
                                <th>Status</th>
                                <th>Published Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="results-history-table">
                            <!-- Results will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button class="btn btn-outline" onclick="loadMoreHistory()">
                        <i class="fas fa-sync"></i> Load More
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>RESULTS MANAGEMENT</h4>
                    <p>Admin panel for managing Matka results</p>
                    <p>Â© 2024 Matka King. All rights reserved.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home Page</a></li>
                        <li><a href="admin.html">Admin Panel</a></li>
                        <li><a href="results-history.html">Results History</a></li>
                        <li><a href="guesser.html">Guesser Panel</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="mobile-menu.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentResults();
            loadResultsHistory();
            
            // Check admin access
            const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            if (!isLoggedIn) {
                window.location.href = 'admin.html?login';
            }
        });
        
        // Load current results into form
        function loadCurrentResults() {
            const results = JSON.parse(localStorage.getItem('matkaResults') || '{}');
            
            const games = [
                { key: 'faridabad', inputId: 'update-faridabad', statusId: 'status-faridabad' },
                { key: 'gaziabad', inputId: 'update-gaziabad', statusId: 'status-gaziabad' },
                { key: 'gali', inputId: 'update-gali', statusId: 'status-gali' },
                { key: 'deshwar', inputId: 'update-deshwar', statusId: 'status-deshwar' },
                { key: 'gali_dubai', inputId: 'update-gali-dubai', statusId: 'status-gali-dubai' },
                { key: 'deshwar_dubai', inputId: 'update-deshwar-dubai', statusId: 'status-deshwar-dubai' }
            ];
            
            games.forEach(game => {
                const resultData = results[game.key];
                const input = document.getElementById(game.inputId);
                const select = document.getElementById(game.statusId);
                
                if (resultData && resultData.result) {
                    input.value = resultData.result;
                    
                    if (resultData.published) {
                        select.value = 'published';
                    } else {
                        select.value = 'ready';
                    }
                } else {
                    input.value = '';
                    select.value = 'pending';
                }
            });
        }
        
        // Update single result
        function updateResult(gameKey) {
            const inputId = `update-${gameKey.replace('_', '-')}`;
            const statusId = `status-${gameKey.replace('_', '-')}`;
            
            const result = document.getElementById(inputId).value.trim();
            const status = document.getElementById(statusId).value;
            
            if (result && !/^\d{2}$/.test(result)) {
                alert('Please enter a valid 2-digit number (00-99)');
                return;
            }
            
            let results = JSON.parse(localStorage.getItem('matkaResults') || '{}');
            const now = new Date();
            
            if (result) {
                results[gameKey] = {
                    result: result,
                    time: now.toLocaleTimeString('en-IN', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: true 
                    }),
                    published: status === 'published',
                    publishTime: status === 'published' ? now.toLocaleTimeString('en-IN', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: true 
                    }) : null
                };
            } else if (results[gameKey]) {
                results[gameKey].published = status === 'published';
            }
            
            localStorage.setItem('matkaResults', JSON.stringify(results));
            
            showNotification(`${gameKey.toUpperCase()} result ${result ? 'updated' : 'status changed'}!`, 'success');
            loadResultsHistory();
        }
        
        // Save all results
        function saveAllResults() {
            const games = ['faridabad', 'gaziabad', 'gali', 'deshwar', 'gali_dubai', 'deshwar_dubai'];
            let hasErrors = false;
            
            games.forEach(gameKey => {
                const inputId = `update-${gameKey.replace('_', '-')}`;
                const input = document.getElementById(inputId);
                const result = input.value.trim();
                
                if (result && !/^\d{2}$/.test(result)) {
                    alert(`Invalid result for ${gameKey.toUpperCase()}: Must be 2 digits (00-99)`);
                    hasErrors = true;
                }
            });
            
            if (hasErrors) return;
            
            games.forEach(gameKey => updateResult(gameKey));
            showNotification('All results saved successfully!', 'success');
        }
        
        // Publish all ready results
        function publishAllReady() {
            let results = JSON.parse(localStorage.getItem('matkaResults') || '{}');
            const now = new Date();
            let publishedCount = 0;
            
            Object.keys(results).forEach(key => {
                if (results[key].result && !results[key].published) {
                    results[key].published = true;
                    results[key].publishTime = now.toLocaleTimeString('en-IN', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: true 
                    });
                    publishedCount++;
                }
            });
            
            localStorage.setItem('matkaResults', JSON.stringify(results));
            
            // Update form
            loadCurrentResults();
            
            showNotification(`${publishedCount} results published successfully!`, 'success');
            loadResultsHistory();
        }
        
        // Clear all results
        function clearAllResults() {
            if (confirm('Are you sure you want to clear ALL results? This cannot be undone.')) {
                localStorage.removeItem('matkaResults');
                loadCurrentResults();
                showNotification('All results cleared!', 'info');
                loadResultsHistory();
            }
        }
        
        // Load results history
        function loadResultsHistory() {
            const results = JSON.parse(localStorage.getItem('matkaResults') || '{}');
            const container = document.getElementById('results-history-table');
            
            if (!container) return;
            
            const today = new Date().toLocaleDateString('en-IN');
            
            let html = '';
            Object.keys(results).forEach(key => {
                const resultData = results[key];
                if (resultData && resultData.result) {
                    const gameName = key.replace('_', ' ').toUpperCase();
                    
                    html += `
                        <tr>
                            <td>${today}</td>
                            <td>${gameName}</td>
                            <td><strong>${resultData.result}</strong></td>
                            <td>
                                ${resultData.published ? 
                                    '<span class="active-status">Published</span>' : 
                                    '<span class="pending-status">Ready</span>'
                                }
                            </td>
                            <td>${resultData.publishTime || resultData.time || 'N/A'}</td>
                            <td>
                                <button class="btn btn-small btn-info" onclick="editResult('${key}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }
            });
            
            container.innerHTML = html || '<tr><td colspan="6" style="text-align: center;">No results yet</td></tr>';
        }
        
        // Edit result
        function editResult(gameKey) {
            const inputId = `update-${gameKey.replace('_', '-')}`;
            const input = document.getElementById(inputId);
            
            if (input) {
                input.scrollIntoView({ behavior: 'smooth' });
                input.focus();
                input.select();
            }
        }
        
        // Load more history
        function loadMoreHistory() {
            // In a real app, this would load more from server
            showNotification('Loading more history...', 'info');
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(el => el.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>
