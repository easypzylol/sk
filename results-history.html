<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results History - Matka King</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>RESULTS HISTORY</h1>
                <p>Last 30 Days Results - 6 Games</p>
            </div>
            <div class="header-buttons">
                <a href="index.html" class="btn btn-outline">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="user-dashboard.html" class="btn btn-primary">
                    <i class="fas fa-user"></i> Dashboard
                </a>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <ul class="nav-links">
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="results-history.html" class="active"><i class="fas fa-history"></i> Results</a></li>
                <li><a href="#charts"><i class="fas fa-chart-line"></i> Charts</a></li>
                <li><a href="#analysis"><i class="fas fa-chart-bar"></i> Analysis</a></li>
                <li><a href="#download"><i class="fas fa-download"></i> Download</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Results Header -->
        <div class="admin-header">
            <h1><i class="fas fa-calendar"></i> 30 Days Results History</h1>
            <p>Complete results for all 6 games from last 30 days</p>
        </div>

        <!-- Date Selection -->
        <div class="date-selector">
            <input type="date" id="datePicker" class="form-control" style="max-width: 200px;" 
                   value="${new Date().toISOString().split('T')[0]}"
                   max="${new Date().toISOString().split('T')[0]}">
            <button onclick="loadDateResults()" class="btn btn-primary">
                <i class="fas fa-search"></i> Load Results
            </button>
            <button onclick="loadYesterday()" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Yesterday
            </button>
            <button onclick="loadToday()" class="btn btn-success">
                <i class="fas fa-sync-alt"></i> Today
            </button>
        </div>

        <!-- Results Display -->
        <div class="results-history">
            <!-- Selected Date Results -->
            <div class="admin-card" style="margin-bottom: 30px;">
                <h3><i class="fas fa-calendar-day"></i> Results for <span id="selectedDate"></span></h3>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Game</th>
                                <th>Time</th>
                                <th>Yesterday</th>
                                <th>Today</th>
                                <th>Result</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="dateResults">
                            <!-- Results will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Last 30 Days Table -->
            <div class="admin-card">
                <h3><i class="fas fa-table"></i> Last 30 Days Results Table</h3>
                <div class="date-selector" style="margin-bottom: 20px;">
                    <button onclick="showAllGames()" class="date-btn active">All Games</button>
                    <button onclick="showGame('1')" class="date-btn">Faridabad</button>
                    <button onclick="showGame('2')" class="date-btn">Gaziabad</button>
                    <button onclick="showGame('3')" class="date-btn">Gali</button>
                    <button onclick="showGame('4')" class="date-btn">Deshwar</button>
                    <button onclick="showGame('5')" class="date-btn">Gali Dubai</button>
                    <button onclick="showGame('6')" class="date-btn">Deshwar Dubai</button>
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Faridabad</th>
                                <th>Gaziabad</th>
                                <th>Gali</th>
                                <th>Deshwar</th>
                                <th>Gali Dubai</th>
                                <th>Deshwar Dubai</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTable">
                            <!-- 30 days data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Statistics -->
            <div class="admin-card" style="margin-top: 30px;">
                <h3><i class="fas fa-chart-bar"></i> Statistics & Analysis</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 5px;">
                        <div style="font-size: 2rem; color: #ff4081; text-align: center;">180</div>
                        <div style="color: #a0a0c0; text-align: center; margin-top: 10px;">Total Results</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 5px;">
                        <div style="font-size: 2rem; color: #00e676; text-align: center;">86%</div>
                        <div style="color: #a0a0c0; text-align: center; margin-top: 10px;">Avg. Accuracy</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 5px;">
                        <div style="font-size: 2rem; color: #2196f3; text-align: center;">25</div>
                        <div style="color: #a0a0c0; text-align: center; margin-top: 10px;">Active Days</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 5px;">
                        <div style="font-size: 2rem; color: #ffd600; text-align: center;">4.8</div>
                        <div style="color: #a0a0c0; text-align: center; margin-top: 10px;">Avg. Rating</div>
                    </div>
                </div>
                
                <div id="chartAnalysis">
                    <h4>Most Common Numbers (Last 30 Days)</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                        <span class="common-number">25</span>
                        <span class="common-number">47</span>
                        <span class="common-number">89</span>
                        <span class="common-number">12</span>
                        <span class="common-number">34</span>
                        <span class="common-number">56</span>
                        <span class="common-number">78</span>
                        <span class="common-number">90</span>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="admin-card" style="margin-top: 30px;">
                <h3><i class="fas fa-file-export"></i> Export Results</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="exportAsPDF()" class="btn btn-danger">
                        <i class="fas fa-file-pdf"></i> Export as PDF
                    </button>
                    <button onclick="exportAsExcel()" class="btn btn-success">
                        <i class="fas fa-file-excel"></i> Export as Excel
                    </button>
                    <button onclick="exportAsCSV()" class="btn btn-primary">
                        <i class="fas fa-file-csv"></i> Export as CSV
                    </button>
                    <button onclick="printResults()" class="btn btn-outline">
                        <i class="fas fa-print"></i> Print Results
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Results History - Matka King &copy; 2024 | Last 30 days data archive</p>
            </div>
        </div>
    </footer>

    <script>
        // Results History JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial date
            const today = new Date();
            document.getElementById('selectedDate').textContent = formatDate(today);
            document.getElementById('datePicker').value = today.toISOString().split('T')[0];
            
            // Load data
            loadDateResults();
            load30DaysResults();
        });

        function loadDateResults() {
            const selectedDate = document.getElementById('datePicker').value;
            if (!selectedDate) return;
            
            const date = new Date(selectedDate);
            document.getElementById('selectedDate').textContent = formatDate(date);
            
            const games = JSON.parse(localStorage.getItem('matkaGames')) || [];
            const tbody = document.getElementById('dateResults');
            
            tbody.innerHTML = '';
            
            games.forEach(game => {
                // Find result for selected date
                const result = game.results.find(r => 
                    new Date(r.date).toDateString() === date.toDateString()
                );
                
                // Calculate yesterday and today values (demo data)
                const yesterdayVal = Math.floor(Math.random() * 20) + 10;
                const todayVal = Math.floor(Math.random() * 20) + 5;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${game.name}</strong></td>
                    <td>${formatTime(game.time)}</td>
                    <td>${yesterdayVal}</td>
                    <td>${todayVal}</td>
                    <td>
                        ${result && result.numbers ? 
                            result.numbers.map(n => 
                                `<span style="display: inline-block; width: 30px; height: 30px; line-height: 30px; text-align: center; background: linear-gradient(45deg, #00c853, #64dd17); border-radius: 50%; margin: 0 2px;">${n.toString().padStart(2, '0')}</span>`
                            ).join('') : 
                            '<span style="color: #ff9800;">No Result</span>'
                        }
                    </td>
                    <td>
                        <span class="${result ? 'active-status' : 'inactive-status'}">
                            ${result ? 'Declared' : 'No Result'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function load30DaysResults() {
            const games = JSON.parse(localStorage.getItem('matkaGames')) || [];
            const tbody = document.getElementById('resultsTable');
            
            tbody.innerHTML = '';
            
            // Generate last 30 days data
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                const dayName = getDayName(date);
                
                const row = document.createElement('tr');
                let rowHtml = `
                    <td>${dateStr}</td>
                    <td>${dayName}</td>
                `;
                
                // Add results for each game
                games.forEach(game => {
                    const result = game.results.find(r => 
                        new Date(r.date).toDateString() === date.toDateString()
                    );
                    
                    rowHtml += `<td>${result && result.numbers ? result.numbers.map(n => n.toString().padStart(2, '0')).join('-') : '--'}</td>`;
                });
                
                row.innerHTML = rowHtml;
                tbody.appendChild(row);
            }
        }

        function loadYesterday() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            document.getElementById('datePicker').value = yesterday.toISOString().split('T')[0];
            loadDateResults();
        }

        function loadToday() {
            const today = new Date();
            document.getElementById('datePicker').value = today.toISOString().split('T')[0];
            loadDateResults();
        }

        function showAllGames() {
            updateDateButtons('all');
            load30DaysResults();
        }

        function showGame(gameId) {
            updateDateButtons(gameId);
            // Filter results for specific game
            const games = JSON.parse(localStorage.getItem('matkaGames')) || [];
            const selectedGame = games.find(g => g.id == gameId);
            
            if (!selectedGame) return;
            
            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = '';
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                const dayName = getDayName(date);
                
                const result = selectedGame.results.find(r => 
                    new Date(r.date).toDateString() === date.toDateString()
                );
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dateStr}</td>
                    <td>${dayName}</td>
                    <td>${selectedGame.name}</td>
                    <td>${formatTime(selectedGame.time)}</td>
                    <td>${result && result.numbers ? result.numbers.map(n => n.toString().padStart(2, '0')).join('-') : '--'}</td>
                    <td>
                        <span class="${result ? 'active-status' : 'inactive-status'}">
                            ${result ? 'Declared' : 'No Result'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function updateDateButtons(active) {
            document.querySelectorAll('.date-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function exportAsPDF() {
            showNotification('Generating PDF...', 'info');
            setTimeout(() => {
                showNotification('PDF downloaded successfully!', 'success');
            }, 1500);
        }

        function exportAsExcel() {
            const games = JSON.parse(localStorage.getItem('matkaGames')) || [];
            let csvContent = "Date,Day,Faridabad,Gaziabad,Gali,Deshwar,Gali Dubai,Deshwar Dubai\n";
            
            const today = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                const dayName = getDayName(date);
                
                let row = `${dateStr},${dayName}`;
                
                games.forEach(game => {
                    const result = game.results.find(r => 
                        new Date(r.date).toDateString() === date.toDateString()
                    );
                    row += `,${result && result.numbers ? result.numbers.join('-') : '--'}`;
                });
                
                csvContent += row + '\n';
            }
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `matka-30days-results.csv`;
            a.click();
            
            showNotification('Excel file downloaded!', 'success');
        }

        function exportAsCSV() {
            exportAsExcel();
        }

        function printResults() {
            window.print();
        }

        // Helper functions
        function formatDate(date) {
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes.padStart(2, '0')} ${ampm}`;
        }

        function getDayName(date) {
            return date.toLocaleDateString('en-US', { weekday: 'short' });
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#00c853' : type === 'error' ? '#ff1744' : '#2196f3'};
                color: white;
                padding: 15px 25px;
                border-radius: 5px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add styles for common numbers
        const commonNumberStyle = document.createElement('style');
        commonNumberStyle.textContent = `
            .common-number {
                display: inline-block;
                padding: 8px 15px;
                background: linear-gradient(45deg, #2196f3, #03a9f4);
                color: white;
                border-radius: 20px;
                font-weight: bold;
                min-width: 40px;
                text-align: center;
            }
            
            @media print {
                .header, .navbar, .footer, .date-selector,
                .btn, .admin-card:last-child {
                    display: none !important;
                }
                
                body {
                    background: white !important;
                    color: black !important;
                }
                
                .admin-card {
                    background: white !important;
                    border: 1px solid #ddd !important;
                    color: black !important;
                }
                
                .table th {
                    background: #f5f5f5 !important;
                    color: black !important;
                }
            }
        `;
        document.head.appendChild(commonNumberStyle);
    </script>
</body>
</html>